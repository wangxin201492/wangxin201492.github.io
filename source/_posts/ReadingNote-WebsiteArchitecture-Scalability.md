---
title: 大型网站技术架构 - 网站的伸缩性架构
date: 2014-07-25 20:23:43
tags:
- system:Scalability
categories:
- ReadingNote
- WebsiteArchitecture
---

## 1.网站架构的伸缩性设计

一般说来，网站的伸缩性设计可分成2类：一类是根据功能进行物理分离实现伸缩（横向，纵向）；一类是单一功能通过集群实现伸缩。

具体说来集群伸缩性又可分为应用服务器集群伸缩性和数据服务器集群伸缩性。这两种集群由于对数据状态管理的不同，技术实现也有很大的区别。而数据服务器集群也可分为缓存数据服务器集群和存储数据服务器集群。

## 2.应用服务器集群的伸缩性设计

如果HTTP请求分发装置可以感知或者可以配置集群的服务器数量，可以及时发现及群众新上线或下线的服务器，并能向新上线的服务器分发请求，停止向已下线的服务器分发请求，那么就实现了应用服务器集群的伸缩性。这个HTTP请求分发装置被称作负载均衡服务器。

1. **HTTP****重定向**
   1. 叙述：一台普通的应用服务器，返回302重定向
   2. 缺点：浏览器需要2次请求服务器才能完成一次访问。重定向服务器自身处理能力是瓶颈。
2. **DNS****域名解析**
   1. 叙述：在DNS服务器中配置多个IP地址
   2. 缺点：目前的DNS时多级解析，每一级DNS都可能`缓存A记录，因此下线某台服务器后，即使修改了DNS的A记录，也不能及时生效。
3. **反向代理（Nginx****）**
   1. 叙述：将请求根据负载均衡算法转发到不同的Web服务器上，Web服务器的响应也需要通过反向代理服务器返回给用户。
   2. 缺点：反向代理时所有请求和相应的中转站，其性能很有可能成为瓶颈。
4. **IP****负载均衡**
   1. 叙述：内核进程更改目的IP地址，不需要经过用户进程（NAT转换）。相比于反向代理有更好的性能。
   2. 缺点：所有请求相应都需要经过负载均衡服务器，集群的最大响应数据吞吐量受制于负载均衡服务器网卡带宽。对于提供下载服务或者视频服务的网站，难以满足需求。
5. **数据链路层反向代理**
   1. 叙述：在数据链路层直接修改mac地址进行负载均衡，不修改src，dest而进行数据分发。避免负载均衡服务器网卡带宽成为瓶颈。这种负载均衡方式有称作DR。
   2. 被称作三角传输模式，时目前大型网站使用最广的一种负载均衡手段。

## 3.分布式缓存集群的伸缩性设计

和所有服务器都部署相同应用的应用服务器集群不同，分布式缓存服务器集群中不同服务器中缓存的数据各不相同，缓存访问请求不可以在缓存服务器集群中的任意一台处理，必须先找到缓存有需要数据的服务器才能访问。

设计原则：必须让新上线的缓存服务器对整个分布式缓存集群影响最小，也就是说新加入缓存服务器后应使整个缓存服务器集群中已经缓存的数据尽可能的被访问到。

**一致性哈希！！！**

## 4.数据存储服务器集群的伸缩性设计

缓存的目的时加速数据读取的速度并减轻数据存储服务器的负载压力，因此，部分缓存丢失不影响业务的正常处理。而数据存储服务器必须保证数据的可靠存储，任何情况下，都必须保证数据的可用性和正确性。

### 4.1关系数据库集群的伸缩性设计

主从复制，读写分离，业务分库。Cobar

### 4.2NoSQL数据库的伸缩性设计

 